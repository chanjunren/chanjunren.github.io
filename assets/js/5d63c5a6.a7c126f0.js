"use strict";(self.webpackChunkliangzai_for_hire=self.webpackChunkliangzai_for_hire||[]).push([[4440],{5680:(e,n,t)=>{t.d(n,{xA:()=>l,yg:()=>m});var r=t(6540);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=r.createContext({}),p=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},l=function(e){var n=p(e.components);return r.createElement(s.Provider,{value:n},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},g=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),d=p(t),g=a,m=d["".concat(s,".").concat(g)]||d[g]||u[g]||i;return t?r.createElement(m,o(o({ref:n},l),{},{components:t})):r.createElement(m,o({ref:n},l))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,o=new Array(i);o[0]=g;var c={};for(var s in n)hasOwnProperty.call(n,s)&&(c[s]=n[s]);c.originalType=e,c[d]="string"==typeof e?e:a,o[1]=c;for(var p=2;p<i;p++)o[p]=t[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}g.displayName="MDXCreateElement"},2686:(e,n,t)=>{t.r(n),t.d(n,{contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>c,toc:()=>s});var r=t(8168),a=(t(6540),t(5680));const i={sidebar_position:3,sidebar_label:"Advice"},o="Advice",c={unversionedId:"Backend/AspectJ/advice",id:"Backend/AspectJ/advice",title:"Advice",description:"- Always associated with a pointcut expression",source:"@site/docs/Backend/AspectJ/advice.md",sourceDirName:"Backend/AspectJ",slug:"/Backend/AspectJ/advice",permalink:"/docs/Backend/AspectJ/advice",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,sidebar_label:"Advice"},sidebar:"docs",previous:{title:"Pointcut",permalink:"/docs/Backend/AspectJ/pointcut"},next:{title:"Comparison",permalink:"/docs/Backend/AspectJ/comparison"}},s=[{value:"Before Advice",id:"before-advice",children:[],level:2},{value:"After returning advice",id:"after-returning-advice",children:[],level:2},{value:"After throwing advice",id:"after-throwing-advice",children:[],level:2},{value:"Around advice",id:"around-advice",children:[],level:2},{value:"Advice Parameters",id:"advice-parameters",children:[{value:"Access to the current JoinPoint",id:"access-to-the-current-joinpoint",children:[],level:3},{value:"Handling generics",id:"handling-generics",children:[],level:3},{value:"Advice ordering",id:"advice-ordering",children:[],level:3}],level:2}],p={toc:s},l="wrapper";function d(e){let{components:n,...t}=e;return(0,a.yg)(l,(0,r.A)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,a.yg)("h1",{id:"advice"},"Advice"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"Always associated with a pointcut expression"),(0,a.yg)("li",{parentName:"ul"},"Runs before / after /around method executions matched by pointcut"),(0,a.yg)("li",{parentName:"ul"},"Can be",(0,a.yg)("ul",{parentName:"li"},(0,a.yg)("li",{parentName:"ul"},"Simple reference to named pointcut"),(0,a.yg)("li",{parentName:"ul"},"Pointcut expression declared in place")))),(0,a.yg)("h2",{id:"before-advice"},"Before Advice"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},'import org.aspectj.lang.annotation.Aspect;\nimport org.aspectj.lang.annotation.Before;\n\n@Aspect\npublic class BeforeExample {\n    @Before("com.xyz.myapp.SystemArchitecture.dataAccessOperation()")\n    public void doAccessCheck() {\n        // ...\n    }\n    \n    // Inline\n    @Before("execution(* com.xyz.myapp.dao.*.*(..))")\n    public void doAccessCheck() {\n        // ...\n    }\n\n}\n')),(0,a.yg)("h2",{id:"after-returning-advice"},"After returning advice"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},'import org.aspectj.lang.annotation.Aspect;\nimport org.aspectj.lang.annotation.AfterReturning;\n\n@Aspect\n// Runs when a matched method execution returns normally => declared after using @AfterReturning annotation\npublic class AfterReturningExample {\n    // When you need access to the actual value that was returned\n    @AfterReturning(\n        pointcut="com.xyz.myapp.SystemArchitecture.dataAccessOperation()",\n        returning="retVal")\n    public void doAccessCheck(Object retVal) {\n        // ...\n    }\n\n}\n')),(0,a.yg)("h2",{id:"after-throwing-advice"},"After throwing advice"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},'import org.aspectj.lang.annotation.Aspect;\nimport org.aspectj.lang.annotation.AfterThrowing;\n\n@Aspect\n// Runs when matched method execution exits by throwing an exception\npublic class AfterThrowingExample {\n\n    @AfterThrowing("com.xyz.myapp.SystemArchitecture.dataAccessOperation()")\n    public void doRecoveryActions() {\n        // ...\n    }\n    \n    For running only when a specific exception occurs\n    @AfterThrowing(\n        pointcut="com.xyz.myapp.SystemArchitecture.dataAccessOperation()",\n        throwing="ex")\n    public void doRecoveryActions(DataAccessException ex) {\n        // ...\n    }\n\n}\n')),(0,a.yg)("h2",{id:"around-advice"},"Around advice"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},'import org.aspectj.lang.annotation.Aspect;\nimport org.aspectj.lang.annotation.Around;\nimport org.aspectj.lang.ProceedingJoinPoint;\n\n@Aspect\npublic class AroundExample {\n\n    @Around("com.xyz.myapp.SystemArchitecture.businessService()")\n    public Object doBasicProfiling(ProceedingJoinPoint pjp) throws Throwable {\n        // start stopwatch\n        Object retVal = pjp.proceed();\n        // stop stopwatch\n        return retVal;\n    }\n\n}\n')),(0,a.yg)("h2",{id:"advice-parameters"},"Advice Parameters"),(0,a.yg)("h3",{id:"access-to-the-current-joinpoint"},"Access to the current JoinPoint"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"ProceedingJoinPoint compulsory for ",(0,a.yg)("inlineCode",{parentName:"li"},"@Around")," annotations"),(0,a.yg)("li",{parentName:"ul"},"Useful methods such as",(0,a.yg)("ul",{parentName:"li"},(0,a.yg)("li",{parentName:"ul"},"getArgs(), getTarget()...")))),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},'\n### Passing Parameters\n\n// Bind using args(...)\n@Pointcut("com.xyz.myapp.SystemArchitecture.dataAccessOperation() && args(account,..)")\nprivate void accountDataAccessOperation(Account account) {}\n\n@Before("accountDataAccessOperation(account)")\npublic void validateAccount(Account account) {\n    // ...\n}\n\n')),(0,a.yg)("div",{className:"admonition admonition-note alert alert--secondary"},(0,a.yg)("div",{parentName:"div",className:"admonition-heading"},(0,a.yg)("h5",{parentName:"div"},(0,a.yg)("span",{parentName:"h5",className:"admonition-icon"},(0,a.yg)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.yg)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,a.yg)("div",{parentName:"div",className:"admonition-content"},(0,a.yg)("p",{parentName:"div"},"args(account, ..) serves 2 purpose:"),(0,a.yg)("ol",{parentName:"div"},(0,a.yg)("li",{parentName:"ol"},"restricts matching only to methods that take at least 1 parameter, and that argument is an instance of ",(0,a.yg)("inlineCode",{parentName:"li"},"Account")),(0,a.yg)("li",{parentName:"ol"},"makes the actual ",(0,a.yg)("inlineCode",{parentName:"li"},"Account")," objet available")))),(0,a.yg)("h3",{id:"handling-generics"},"Handling generics"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"public interface Sample<T> {\n    void sampleGenericMethod(T param);\n    void sampleGenericCollectionMethod(Collection>T> param);\n}\n")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},'@Before("execution(* ..Sample+.sampleGenericMethod(*)) && args(param)")\npublic void beforeSampleMethod(MyType param) {\n    // Advice implementation\n}\n')),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},'@Before("execution(* ..Sample+.sampleGenericCollectionMethod(*)) && args(param)")\npublic void beforeSampleMethod(Collection<MyType> param) {\n    // Advice implementation\n}\n')),(0,a.yg)("h3",{id:"advice-ordering"},"Advice ordering"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},'Lazy to write this so I\'m just pasting this whole thing\n\nWhat happens when multiple pieces of advice all want to run at the same join point? Spring AOP follows the same precedence rules as AspectJ to determine the order of advice execution. The highest precedence advice runs first "on the way in" (so given two pieces of before advice, the one with highest precedence runs first). "On the way out" from a join point, the highest precedence advice runs last (so given two pieces of after advice, the one with the highest precedence will run second).\n\nWhen two pieces of advice defined in different aspects both need to run at the same join point, unless you specify otherwise the order of execution is undefined. You can control the order of execution by specifying precedence. This is done in the normal Spring way by either implementing the org.springframework.core.Ordered interface in the aspect class or annotating it with the Order annotation. Given two aspects, the aspect returning the lower value from Ordered.getValue() (or the annotation value) has the higher precedence.\n\nWhen two pieces of advice defined in the same aspect both need to run at the same join point, the ordering is undefined (since there is no way to retrieve the declaration order via reflection for javac-compiled classes). Consider collapsing such advice methods into one advice method per join point in each aspect class, or refactor the pieces of advice into separate aspect classes - which can be ordered at the aspect level.\n\n')))}d.isMDXComponent=!0}}]);