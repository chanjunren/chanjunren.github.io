"use strict";(self.webpackChunkliangzai_for_hire=self.webpackChunkliangzai_for_hire||[]).push([[1461],{5680:(e,a,t)=>{t.d(a,{xA:()=>p,yg:()=>c});var n=t(6540);function i(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function r(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function l(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((function(a){i(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function o(e,a){if(null==e)return{};var t,n,i=function(e,a){if(null==e)return{};var t,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||(i[t]=e[t]);return i}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=n.createContext({}),g=function(e){var a=n.useContext(s),t=a;return e&&(t="function"==typeof e?e(a):l(l({},a),e)),t},p=function(e){var a=g(e.components);return n.createElement(s.Provider,{value:a},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},d=n.forwardRef((function(e,a){var t=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),m=g(t),d=i,c=m["".concat(s,".").concat(d)]||m[d]||u[d]||r;return t?n.createElement(c,l(l({ref:a},p),{},{components:t})):n.createElement(c,l({ref:a},p))}));function c(e,a){var t=arguments,i=a&&a.mdxType;if("string"==typeof e||i){var r=t.length,l=new Array(r);l[0]=d;var o={};for(var s in a)hasOwnProperty.call(a,s)&&(o[s]=a[s]);o.originalType=e,o[m]="string"==typeof e?e:i,l[1]=o;for(var g=2;g<r;g++)l[g]=t[g];return n.createElement.apply(null,l)}return n.createElement.apply(null,t)}d.displayName="MDXCreateElement"},3531:(e,a,t)=>{t.r(a),t.d(a,{contentTitle:()=>l,default:()=>m,frontMatter:()=>r,metadata:()=>o,toc:()=>s});var n=t(8168),i=(t(6540),t(5680));const r={sidebar_position:2,sidebar_label:"Performance toolbox"},l="Java Performance Toolbox",o={unversionedId:"Backend/Java/JVM/jvm-3-1",id:"Backend/Java/JVM/jvm-3-1",title:"Java Performance Toolbox",description:"Performance analysis is all about visibility => Must have data",source:"@site/docs/Backend/Java/JVM/jvm-3-1.md",sourceDirName:"Backend/Java/JVM",slug:"/Backend/Java/JVM/jvm-3-1",permalink:"/docs/Backend/Java/JVM/jvm-3-1",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,sidebar_label:"Performance toolbox"},sidebar:"docs",previous:{title:"Performance Testing",permalink:"/docs/Backend/Java/JVM/jvm-2"},next:{title:"Monitoring tools",permalink:"/docs/Backend/Java/JVM/jvm-3-2"}},s=[{value:"Operating Tools and Analysis",id:"operating-tools-and-analysis",children:[],level:2},{value:"CPU Usage",id:"cpu-usage",children:[{value:"Single CPU Usage",id:"single-cpu-usage",children:[],level:3},{value:"Multiple CPU Usage",id:"multiple-cpu-usage",children:[],level:3},{value:"CPU Run Queue",id:"cpu-run-queue",children:[],level:3}],level:2},{value:"Disk Usage",id:"disk-usage",children:[{value:"Example where I/O is bottleneck",id:"example-where-io-is-bottleneck",children:[],level:3},{value:"Example where disk cannot keep up with I/O Requests",id:"example-where-disk-cannot-keep-up-with-io-requests",children:[],level:3},{value:"Indication for swapping",id:"indication-for-swapping",children:[],level:3}],level:2},{value:"Network Usage",id:"network-usage",children:[],level:2}],g={toc:s},p="wrapper";function m(e){let{components:a,...t}=e;return(0,i.yg)(p,(0,n.A)({},g,t,{components:a,mdxType:"MDXLayout"}),(0,i.yg)("h1",{id:"java-performance-toolbox"},"Java Performance Toolbox"),(0,i.yg)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.yg)("div",{parentName:"div",className:"admonition-heading"},(0,i.yg)("h5",{parentName:"div"},(0,i.yg)("span",{parentName:"h5",className:"admonition-icon"},(0,i.yg)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.yg)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.yg)("div",{parentName:"div",className:"admonition-content"},(0,i.yg)("p",{parentName:"div"},"Performance analysis is all about visibility => Must have data"))),(0,i.yg)("h2",{id:"operating-tools-and-analysis"},"Operating Tools and Analysis"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Unix: iostat, vmstat, prstat ..."),(0,i.yg)("li",{parentName:"ul"},"Windows: typeperf")),(0,i.yg)("h2",{id:"cpu-usage"},"CPU Usage"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Terms"),(0,i.yg)("li",{parentName:"ul"},"User Time: % of time spent executing application code "),(0,i.yg)("li",{parentName:"ul"},"System Time: % of time spent executing kernel code"),(0,i.yg)("li",{parentName:"ul"},"Goal: Drive CPU usage as high as possible for as short a time as possible",(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"Indication of how effective your application is at utilizing CPU"))),(0,i.yg)("li",{parentName:"ul"},"Reasons for idle",(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"Blocked on synchronization primitive => unable to execute until lock is released"),(0,i.yg)("li",{parentName:"ul"},"Waiting for something (e.g. DB response)"),(0,i.yg)("li",{parentName:"ul"},"No work to do")))),(0,i.yg)("h3",{id:"single-cpu-usage"},"Single CPU Usage"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"e.g. Server-style application"),(0,i.yg)("li",{parentName:"ul"},"vmstat's measurements are in unit of seconds",(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"might not be granular enough"),(0,i.yg)("li",{parentName:"ul"},"e.g. Processing a request takes 450ms"),(0,i.yg)("li",{parentName:"ul"},"CPU usage at 100% for 450ms, idle for 550ms => CPU usage = 45%"),(0,i.yg)("li",{parentName:"ul"},"Thus makes sense to aim for lower CPU usages i.e. finish processing request in 400ms ")))),(0,i.yg)("h3",{id:"multiple-cpu-usage"},"Multiple CPU Usage"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Same concept as single CPU"),(0,i.yg)("li",{parentName:"ul"},"General Goal",(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"drive CPU higher by making sure CPU threads not blocked"),(0,i.yg)("li",{parentName:"ul"},"drive CPU lower by finishing tasks earlier => idle for longer")))),(0,i.yg)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.yg)("div",{parentName:"div",className:"admonition-heading"},(0,i.yg)("h5",{parentName:"div"},(0,i.yg)("span",{parentName:"h5",className:"admonition-icon"},(0,i.yg)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.yg)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.yg)("div",{parentName:"div",className:"admonition-content"},(0,i.yg)("p",{parentName:"div"},"Application with fixed size threadpool running various tasks => Threads blocked (they can only execute one task at a time) => ",(0,i.yg)("em",{parentName:"p"},"CPU can be idle even if there is task to do")," "),(0,i.yg)("ul",{parentName:"div"},(0,i.yg)("li",{parentName:"ul"},"Number of tasks > number of threads")))),(0,i.yg)("h3",{id:"cpu-run-queue"},"CPU Run Queue"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("em",{parentName:"li"},"Run (Processor) Queue"),": number of threads that can be run",(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"Find using ",(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"vmstat (unix): shows running threads and threads that can run"),(0,i.yg)("li",{parentName:"ul"},"typeperf (windows): only shows threads that can run"))),(0,i.yg)("li",{parentName:"ul"},"Represents everything on the machine"))),(0,i.yg)("li",{parentName:"ul"},"Number of threads > CPU => performance degrade"),(0,i.yg)("li",{parentName:"ul"},"Run queue length too high for significant period => Indication that machine is overloaded",(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"Look into reducing machine's work (moving jobs to another machine / optimising code)")))),(0,i.yg)("div",{className:"admonition admonition-info alert alert--info"},(0,i.yg)("div",{parentName:"div",className:"admonition-heading"},(0,i.yg)("h5",{parentName:"div"},(0,i.yg)("span",{parentName:"h5",className:"admonition-icon"},(0,i.yg)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.yg)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.yg)("div",{parentName:"div",className:"admonition-content"},(0,i.yg)("p",{parentName:"div"},"Quick summary"),(0,i.yg)("ol",{parentName:"div"},(0,i.yg)("li",{parentName:"ol"},"CPU utilization is the first thing to consider when looking at the performance of an application"),(0,i.yg)("li",{parentName:"ol"},"Attempt to drive CPU high for as short time as possible"),(0,i.yg)("li",{parentName:"ol"},"Understand why CPU usage is low before optimizing")))),(0,i.yg)("h2",{id:"disk-usage"},"Disk Usage"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Goals of monitoring disk usage",(0,i.yg)("ol",{parentName:"li"},(0,i.yg)("li",{parentName:"ol"},"If I/O intensive application => easy for I/O to become bottleneck "),(0,i.yg)("li",{parentName:"ol"},"Lookout for",(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"Low disk usage: not efficiently buffering data"),(0,i.yg)("li",{parentName:"ul"},"High disk usage: buffering more than it can handle"))))),(0,i.yg)("li",{parentName:"ul"},"Can be tricky ")),(0,i.yg)("h3",{id:"example-where-io-is-bottleneck"},"Example where I/O is bottleneck"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre"},"% iostat -xm 5\navg-cpu:  %user   %nice %system %iowait  %steal   %idle\n          23.45    0.00   37.89    0.10    0.00   38.56\n\n          Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s\n          sda               0.00    11.60    0.60   24.20     0.02\n\n          wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util\n          0.14    13.35     0.15    6.06    5.33    6.08   0.42   1.04\n")),(0,i.yg)("table",null,(0,i.yg)("thead",{parentName:"table"},(0,i.yg)("tr",{parentName:"thead"},(0,i.yg)("th",{parentName:"tr",align:null},"value"),(0,i.yg)("th",{parentName:"tr",align:null},"description"),(0,i.yg)("th",{parentName:"tr",align:null},"explanation"))),(0,i.yg)("tbody",{parentName:"table"},(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"w_await"),(0,i.yg)("td",{parentName:"tr",align:null},"time to service each I/O write"),(0,i.yg)("td",{parentName:"tr",align:null},"Fairly low")),(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"%util"),(0,i.yg)("td",{parentName:"tr",align:null},"Disk utilization"),(0,i.yg)("td",{parentName:"tr",align:null},"Also looks ok")),(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"%system"),(0,i.yg)("td",{parentName:"tr",align:null},"Time spent in kernel"),(0,i.yg)("td",{parentName:"tr",align:null},"quite high, if system is doing other I/O in applications maybe it's ok")),(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"writes per second"),(0,i.yg)("td",{parentName:"tr",align:null},"as per name"),(0,i.yg)("td",{parentName:"tr",align:null},"quite a lot of writes for 0.14MBps")))),(0,i.yg)("h3",{id:"example-where-disk-cannot-keep-up-with-io-requests"},"Example where disk cannot keep up with I/O Requests"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre"},"% iostat -xm 5\navg-cpu:  %user   %nice %system %iowait  %steal   %idle\n          35.05    0.00    7.85   47.89    0.00    9.20\n\n          Device:         rrqm/s   wrqm/s     r/s     w/s    rMB/s\n          sda               0.00     0.20    1.00  163.40     0.00\n\n          wMB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util\n          81.09  1010.19   142.74  866.47   97.60  871.17   6.08 100.00\n")),(0,i.yg)("table",null,(0,i.yg)("thead",{parentName:"table"},(0,i.yg)("tr",{parentName:"thead"},(0,i.yg)("th",{parentName:"tr",align:null},"value"),(0,i.yg)("th",{parentName:"tr",align:null},"explanation"))),(0,i.yg)("tbody",{parentName:"table"},(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"%util"),(0,i.yg)("td",{parentName:"tr",align:null},"100% is an indication")),(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"w_await"),(0,i.yg)("td",{parentName:"tr",align:null},"871ms => queue quite large")),(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"wMB/s"),(0,i.yg)("td",{parentName:"tr",align:null},"81.09 MB => quite large")))),(0,i.yg)("h3",{id:"indication-for-swapping"},"Indication for swapping"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Applications might use large amounts of VIRTUAL memory => might lead to swapping => bad performance"),(0,i.yg)("li",{parentName:"ul"},"Can monitor disk usage to monitor for swapping"),(0,i.yg)("li",{parentName:"ul"},"Use ",(0,i.yg)("em",{parentName:"li"},"vmstat"),(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("em",{parentName:"li"},"si")," swap in"),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("em",{parentName:"li"},"so")," swap out")))),(0,i.yg)("h2",{id:"network-usage"},"Network Usage"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Bottlenecks can occur when too little (inefficient writing of data) or too high (too much data) throughput")))}m.isMDXComponent=!0}}]);